<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>hello phaser!</title>
        <script src="//cdn.jsdelivr.net/phaser/2.5.0/phaser.min.js"></script>
        <script src="controlable.js"></script>
        <script src="grid_movement.js"></script>
    </head>
    <body>

    <script type="text/javascript">
    window.onload = function() {
        var session_id = prompt("What is the session_id?");

        var game = new Phaser.Game(320, 320, Phaser.AUTO, '', { preload: preload, create: create, update: update });
        window.controlable = new Controllable(game);
        window.grid = new GridMovement("32x32", "10x10");

        function preload () {
            game.load.tilemap('map', 'assets/tileset.csv', null, Phaser.Tilemap.CSV);
            game.load.image('tiles', 'assets/base_tileset.png');
            game.load.spritesheet('hero', 'assets/charset.png', 32, 32);
        }

        function create () {
            // Rendering Tilemaps and World
            this.map = this.add.tilemap('map', 32, 32);
            this.map.addTilesetImage('tiles');
            this.layer = this.map.createLayer(0);
            this.layer.resizeWorld();

            // Rendering Slot 1
            window.p1 = this.add.tileSprite(0, 0, 32, 32, 'hero');
            p1.animations.add('iddle', [0], 10, true);
            p1.animations.play('iddle');

            // Rendering Slot 2
            window.p2 = this.add.tileSprite(0, 0, 32, 32, 'hero');
            p2.animations.add('iddle', [5], 10, true);
            p2.animations.play('iddle');

            // Setup slots initial position
            grid.move(p1, 1,1);
            grid.move(p2, 2,2);

            // Delegate which Slot the player controls
            controlable.delegate(p1);
        }

        function update() {
          controlable.control();
        }

    };

    </script>

    </body>
</html>
